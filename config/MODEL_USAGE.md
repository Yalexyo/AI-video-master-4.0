# ğŸ¯ AIæ¨¡å‹é…ç½®ä¸ç®¡ç†æŒ‡å— - ç»Ÿä¸€é…ç½®æ—¶ä»£

## ğŸ“‹ é…ç½®æ¶æ„æ¦‚è¿°

### ğŸ”§ **ç»Ÿä¸€é…ç½®ä¸­å¿ƒ** âœ… å·²å®ç°
ç³»ç»Ÿç°å·²é‡‡ç”¨**ç»Ÿä¸€é…ç½®ç®¡ç†**ï¼Œæ‰€æœ‰AIæ¨¡å‹ç›¸å…³é…ç½®ç»Ÿä¸€åœ¨ `config/keywords.yml` ä¸­ç®¡ç†ã€‚

```
é…ç½®å±‚æ¬¡æ¶æ„ï¼š
config/keywords.yml          # ğŸ¯ ç»Ÿä¸€å…³é”®è¯ä¸prompté…ç½®
â”œâ”€â”€ modules                  # ä¸šåŠ¡æ¨¡å—å…³é”®è¯
â”œâ”€â”€ emotions                 # æ ‡å‡†æƒ…ç»ªæšä¸¾
â”œâ”€â”€ brands                   # å“ç‰Œå…³é”®è¯  
â”œâ”€â”€ visual_objects           # è§†è§‰è¯†åˆ«å¯¹è±¡
â”œâ”€â”€ scenes                   # åœºæ™¯ç±»åˆ«
â””â”€â”€ audio_objects            # éŸ³é¢‘è¯†åˆ«å¯¹è±¡

streamlit_app/config/        # ğŸ  åº”ç”¨ä¸“ç”¨é…ç½®
â”œâ”€â”€ config.py               # ç›®æ ‡äººç¾¤ã€äº§å“ç±»å‹ç­‰
â”œâ”€â”€ factory_config.py       # å·¥å‚æ¨¡å—é…ç½®
â””â”€â”€ mixing_config.py        # æ··å‰ªæ¨¡å—é…ç½®
```

## ğŸ¤– æ¨¡å‹åˆ†å·¥ä¸èŒè´£

### 1. Qwen-VL-Chat (è§†è§‰åˆ†æ)
**ä¸“èŒ**: ğŸ–¼ï¸ ç”»é¢å†…å®¹è¯†åˆ«

**è§¦å‘æ—¶æœº**:
- è§†é¢‘å¸§é‡‡æ ·åˆ†æ
- å®æ—¶è§†è§‰å†…å®¹è¯†åˆ«
- å¤šæ¨¡æ€åœºæ™¯ç†è§£

**Prompté…ç½®**: 
- ğŸ“ ä½ç½®: `keywords.yml` â†’ `qwen_visual` template  
- ğŸ”§ ç®¡ç†: `streamlit_app/utils/keyword_config.py`
- ğŸ¯ ç”¨é€”: æå– objectã€sceneã€emotionã€brand_elements

```python
# ğŸ”§ ç»Ÿä¸€è°ƒç”¨æ–¹å¼
from streamlit_app.utils.keyword_config import sync_prompt_templates
templates = sync_prompt_templates()
qwen_prompt = templates["qwen_visual"]
```

### 2. DeepSeek-Chat (è¯­ä¹‰åˆ†æ)
**ä¸“èŒ**: ğŸ§ éŸ³é¢‘è½¬å½•åˆ†æ + ğŸ‘¥ ç›®æ ‡äººç¾¤è¯†åˆ«

**ä½¿ç”¨åœºæ™¯**:
- éŸ³é¢‘è½¬å½•å†…å®¹åˆ†æ
- ç›®æ ‡äººç¾¤è‡ªåŠ¨è¯†åˆ«  
- è¯­ä¹‰ç‰‡æ®µåˆ†ç±»
- è‹±ä¸­ç¿»è¯‘æœåŠ¡

**Prompté…ç½®**:
- ğŸ“ éŸ³é¢‘åˆ†æ: `deepseek_audio` template
- ğŸ“ äººç¾¤è¯†åˆ«: `target_audience` template  
- ğŸ“ è¯­ä¹‰åˆ†æ: `semantic_analysis` template

### 3. SentenceTransformer (æ–‡æœ¬åµŒå…¥)
**ä¸“èŒ**: ğŸ“Š ç¦»çº¿æ–‡æœ¬ç›¸ä¼¼åº¦è®¡ç®—

**ä¸»æ¨¡å‹**: `all-MiniLM-L6-v2` (87MB)
**å¤‡ç”¨æ¨¡å‹**: `paraphrase-multilingual-MiniLM-L12-v2` (471MB)

**è‡ªåŠ¨åˆ‡æ¢æœºåˆ¶** âœ… å·²å®ç°:
```
1. å°è¯•ä¸»æ¨¡å‹ â†’ æˆåŠŸåˆ™è¿”å›ç»“æœ
2. ä¸»æ¨¡å‹å¤±è´¥ â†’ è‡ªåŠ¨åˆ‡æ¢å¤‡ç”¨æ¨¡å‹
3. å¤‡ç”¨æ¨¡å‹å¤±è´¥ â†’ è¿”å›"å…¶ä»–"å…œåº•
```

## ğŸ¯ äººç¾¤åˆ’åˆ†ç³»ç»Ÿè¯¦è§£

### **ä¸ºä»€ä¹ˆéœ€è¦äººç¾¤åˆ’åˆ†ï¼Ÿ**

æ¯å©´è¥é”€å…·æœ‰**å¼ºçƒˆçš„äººç¾¤ç‰¹å¾**ï¼Œä¸åŒäººç¾¤å…³æ³¨ç‚¹å®Œå…¨ä¸åŒï¼š

| äººç¾¤ç±»å‹ | å…³æ³¨é‡ç‚¹ | å…¸å‹åœºæ™¯ | å…³é”®è¯ä¿¡å· |
|---------|----------|----------|------------|
| **å­•æœŸå¦ˆå¦ˆ** | è¥å…»å®‰å…¨ã€èƒå„¿å‘è‚² | å­•æ£€ã€è¥å…»è¡¥å…… | "å­•æœŸ"ã€"èƒå„¿"ã€"å¶é…¸" |
| **æ–°æ‰‹çˆ¸å¦ˆ** | å–‚å…»æŒ‡å¯¼ã€è‚²å„¿çŸ¥è¯† | æ–°ç”Ÿå„¿æŠ¤ç†ã€å–‚å¥¶æŠ€å·§ | "æ–°ç”Ÿå„¿"ã€"ç¬¬ä¸€æ¬¡"ã€"æ€ä¹ˆåŠ" |
| **äºŒèƒå¦ˆå¦ˆ** | å®ç”¨æ€§ã€æ€§ä»·æ¯” | äºŒèƒç»éªŒã€æ—¶é—´ç®¡ç† | "äºŒèƒ"ã€"å¿™ç¢Œ"ã€"çœå¿ƒ" |
| **æ··å…»å¦ˆå¦ˆ** | æ¯ä¹³+å¥¶ç²‰å¹³è¡¡ | æ··åˆå–‚å…»ã€è¥å…»æ­é… | "æ··å–‚"ã€"æ¯ä¹³ä¸å¤Ÿ"ã€"è¥å…»" |
| **è´µå¦‡å¦ˆå¦ˆ** | å“è´¨ã€é«˜ç«¯é…æ–¹ | é«˜ç«¯äº§å“ã€è¿›å£å“ç‰Œ | "æœ‰æœº"ã€"è¿›å£"ã€"é«˜ç«¯" |

### **äººç¾¤è¯†åˆ«æµç¨‹**:
```
å®Œæ•´è½¬å½•æ–‡æœ¬ â†’ DeepSeekåˆ†æ â†’ å†…å®¹ç‰¹å¾æå– â†’ äººç¾¤åŒ¹é… â†’ ä¸šåŠ¡å†³ç­–
                    â†“
            "æåˆ°äºŒèƒã€å¿™ç¢Œã€çœå¿ƒ" â†’ äºŒèƒå¦ˆå¦ˆ
            "æåˆ°å­•æœŸã€èƒå„¿å‘è‚²" â†’ å­•æœŸå¦ˆå¦ˆ  
            "æåˆ°æ–°æ‰‹ã€ç¬¬ä¸€æ¬¡" â†’ æ–°æ‰‹çˆ¸å¦ˆ
```

## ğŸ”„ é…ç½®ç®¡ç†æœ€ä½³å®è·µ

### âœ… **å·²å®ç°çš„ä¼˜åŒ–**

#### 1. ç»Ÿä¸€Promptç®¡ç†
```python
# âŒ æ—§æ–¹å¼ - åˆ†æ•£åœ¨å„æ–‡ä»¶ä¸­
def _build_prompt(self):
    return f"ä½ æ˜¯ä¸“å®¶..." # ç¡¬ç¼–ç 

# âœ… æ–°æ–¹å¼ - ç»Ÿä¸€é…ç½®
from streamlit_app.utils.keyword_config import sync_prompt_templates
templates = sync_prompt_templates()
prompt = templates["qwen_visual"]
```

#### 2. é…ç½®å¥åº·æ£€æŸ¥
```python
from streamlit_app.utils.keyword_config import health_check

# ç³»ç»Ÿè‡ªæ£€
health = health_check()
print(f"é…ç½®çŠ¶æ€: {health['overall_status']}")
print(f"é”™è¯¯æ•°é‡: {len(health['errors'])}")
```

#### 3. å…¼å®¹æ€§éªŒè¯
```python
from streamlit_app.utils.keyword_config import check_compatibility

# æ¨¡å—å…¼å®¹æ€§æ£€æŸ¥
compatibility = check_compatibility()
print(f"Qwenå…¼å®¹: {compatibility['qwen_analyzer']}")
print(f"DeepSeekå…¼å®¹: {compatibility['deepseek_analyzer']}")
```

### ğŸ¯ **ä½¿ç”¨æŒ‡å—**

#### å¼€å‘è€…æ—¥å¸¸æ“ä½œ
```bash
# 1. æ£€æŸ¥é…ç½®çŠ¶æ€
python -c "from streamlit_app.utils.keyword_config import health_check; print(health_check())"

# 2. å¯¼å‡ºé…ç½®æ‘˜è¦  
python -c "from streamlit_app.utils.keyword_config import export_config_summary; print(export_config_summary())"

# 3. é‡æ–°åŠ è½½é…ç½®
python -c "from streamlit_app.utils.keyword_config import reload_config; reload_config()"
```

#### ç”Ÿäº§ç¯å¢ƒç›‘æ§
```python
# åœ¨åº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨æ£€æŸ¥
from streamlit_app.utils.keyword_config import health_check, check_compatibility

def startup_check():
    health = health_check()
    compatibility = check_compatibility()
    
    if health["overall_status"] == "error":
        raise RuntimeError(f"é…ç½®é”™è¯¯: {health['errors']}")
    
    incompatible_modules = [k for k, v in compatibility.items() if not v]
    if incompatible_modules:
        logger.warning(f"æ¨¡å—å…¼å®¹æ€§é—®é¢˜: {incompatible_modules}")
```

## ğŸ“Š æ¨¡å‹æ€§èƒ½å¯¹æ¯” & ä½¿ç”¨å»ºè®®

### SentenceTransformer åŒæ¨¡å‹ç­–ç•¥

| ç‰¹æ€§ | ä¸»æ¨¡å‹ (all-MiniLM-L6-v2) | å¤‡ç”¨æ¨¡å‹ (paraphrase-multilingual) |
|------|---------------------------|-----------------------------------|
| **å¤§å°** | 87MB | 471MB |
| **é€Ÿåº¦** | âš¡ å¿« (0.01-0.05s) | ğŸŒ è¾ƒæ…¢ (0.02-0.08s) |
| **ç²¾åº¦** | ğŸ¯ æ ‡å‡† | ğŸ¯ğŸ¯ æ›´é«˜ |
| **å¤šè¯­è¨€** | âœ… æ”¯æŒ | âœ…âœ… æ›´å¼º |
| **ä½¿ç”¨åœºæ™¯** | æ—¥å¸¸æ‰¹é‡å¤„ç† | å¤æ‚æ–‡æœ¬/å¤±è´¥é‡è¯• |

### AIæ¨¡å‹è°ƒç”¨ç­–ç•¥

```
è§†é¢‘åˆ†æä¼˜å…ˆçº§ (å·²ä¼˜åŒ–):

1. ğŸ”§ å…³é”®è¯è§„åˆ™åˆ†ç±» (æœ€å¿«)
   â”œâ”€â”€ ç—›ç‚¹ä¿¡å·æ£€æµ‹
   â”œâ”€â”€ æ´»åŠ›ä¿ƒé”€æ£€æµ‹  
   â””â”€â”€ å“ç‰Œå–ç‚¹æ£€æµ‹

2. ğŸ¤– DeepSeek AIåˆ†ç±» (ç¬¬äºŒä¼˜å…ˆçº§)
   â”œâ”€â”€ è¶…æ—¶è®¾ç½®: 10ç§’
   â”œâ”€â”€ å¤±è´¥è‡ªåŠ¨é™çº§
   â””â”€â”€ æˆæœ¬æ§åˆ¶

3. ğŸ“Š Embeddingç›¸ä¼¼åº¦ (ç¬¬ä¸‰ä¼˜å…ˆçº§)
   â”œâ”€â”€ ä¸»æ¨¡å‹ä¼˜å…ˆ
   â”œâ”€â”€ å¤±è´¥è‡ªåŠ¨åˆ‡æ¢å¤‡ç”¨æ¨¡å‹
   â””â”€â”€ ç¦»çº¿è®¡ç®—

4. ğŸ›¡ï¸ å…œåº•æœºåˆ¶
   â””â”€â”€ è¿”å›"å…¶ä»–"åˆ†ç±»
```

## ğŸš€ æ–°åŠŸèƒ½ä¸æ”¹è¿›

### âœ… **å·²å®Œæˆä¼˜åŒ–** (2025-01-02 æ›´æ–°)

1. **ğŸ¯ ç»Ÿä¸€é…ç½®ä¸­å¿ƒ**
   - åˆ é™¤é‡å¤çš„ `matching_rules_default.json`
   - åˆ é™¤å¼ƒç”¨çš„ `fallback_ai.json`  
   - ç»Ÿä¸€ä½¿ç”¨ `keywords.yml` ç®¡ç†æ‰€æœ‰prompt

2. **ğŸ”§ é…ç½®ç®¡ç†å¢å¼º**
   - æ·»åŠ å¥åº·æ£€æŸ¥åŠŸèƒ½
   - æ·»åŠ å…¼å®¹æ€§éªŒè¯
   - æ·»åŠ é…ç½®å¯¼å‡ºåŠŸèƒ½
   - æ”¹è¿›é”™è¯¯å¤„ç†æœºåˆ¶

3. **ğŸ¤– AIæ¨¡å‹ä¼˜åŒ–**
   - DeepSeek prompté‡æ„ï¼Œå»é™¤é‡å¤å®šä¹‰
   - Qwen promptç»Ÿä¸€é…ç½®åŒ–
   - Embeddingæ¨¡å‹fallbackæœºåˆ¶å®Œå–„

4. **ğŸ‘¥ äººç¾¤è¯†åˆ«æ”¹è¿›**
   - ç»Ÿä¸€äººç¾¤åˆ’åˆ†prompt
   - æ”¹è¿›ç›®æ ‡äººç¾¤è¯†åˆ«å‡†ç¡®æ€§
   - ä¸šåŠ¡é€»è¾‘ä¸AIåˆ†æåˆ†ç¦»

### ğŸ¯ **ä½¿ç”¨å»ºè®®**

#### æ–°é¡¹ç›®æ¥å…¥
1. ç¡®ä¿ç¯å¢ƒå˜é‡é…ç½®ï¼š`DEEPSEEK_API_KEY`ã€`DASHSCOPE_API_KEY`
2. æ£€æŸ¥é…ç½®å¥åº·çŠ¶æ€ï¼š`health_check()`
3. éªŒè¯æ¨¡å—å…¼å®¹æ€§ï¼š`check_compatibility()`
4. æ ¹æ®éœ€è¦è°ƒæ•´ `config/keywords.yml`

#### é…ç½®æ›´æ–°æµç¨‹
1. ä¿®æ”¹ `config/keywords.yml`
2. è°ƒç”¨ `reload_config()` é‡æ–°åŠ è½½
3. è¿è¡Œ `health_check()` éªŒè¯
4. æµ‹è¯•ç›¸å…³åŠŸèƒ½æ¨¡å—

#### ç”Ÿäº§ç¯å¢ƒç›‘æ§
- æ¯æ—¥æ£€æŸ¥é…ç½®å¥åº·çŠ¶æ€
- ç›‘æ§æ¨¡å‹è°ƒç”¨æˆåŠŸç‡
- å®šæœŸå¯¼å‡ºé…ç½®æ‘˜è¦å¤‡ä»½
