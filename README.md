# 🏭 视频智能工厂 4.0

**将KOL的长视频自动分析并智能分类为"痛点/解决方案/卖点/促销"四个营销模块，然后重新组合生成精准的营销混剪视频。**

一个专为内容优化的AI视频处理系统，基于Streamlit构建的四大工厂架构，通过多模型协同分析实现从视频转录、智能分析、AI行为调优到营销混剪的完整工作流。

## 🎯 核心价值

### 🚀 营销自动化
- **智能分类**: 自动识别内容中的痛点、解决方案、卖点和促销信息
- **精准混剪**: 基于营销逻辑重新组合视频片段，生成高转化率的营销素材
- **批量处理**: 支持大规模KOL内容的自动化处理

### 🤖 AI技术优势
- **多模型协同**: Qwen视觉 + DeepSeek音频 + Google Cloud多维度分析
- **品牌感知**: 智能识别品牌(启赋、illuma等)，避免误杀真实产品场景
- **反幻觉机制**: 三层智能决策，确保分析结果的准确性和可靠性

## 🏗️ 工厂系统概览

### 🧫 零件工厂 (Parts Factory)
**功能：视频转录与字幕生成**
- 高精度语音转录 (基于DashScope API)
- 自动SRT字幕文件生成
- 专业词汇优化
- 批量视频处理支持

### 🧱 组装工厂 (Assembly Factory)  
**功能：多模型AI分析与智能切分**
- **Qwen2.5视觉分析**: 识别场景、物体、品牌元素
- **DeepSeek音频分析**: 语音转录与语义理解
- **Google Cloud集成**: 视频内容深度分析
- **智能兜底机制**: 多模型协同确保分析质量

### 🐛 调试工厂 (Debug Factory)
**功能：AI行为调优与业务词表管理**
- **可视化词表编辑**: 通过UI界面管理业务关键词(物体、场景、情绪、品牌)
- **动态Prompt生成**: AI指令根据业务词表实时生成，精确控制AI行为
- **权重智能配置**: 为关键词设置权重，影响分类优先级
- **实时预览**: 即时查看配置变更对AI Prompt的影响

### 🧪 混剪工厂 (Mixing Factory)
**功能：营销导向的智能视频分类与合成**
- **四模块分类**: 痛点/解决方案/卖点/促销的智能分类算法
- **权重累积引擎**: 基于关键词权重的智能评分系统
- **负向过滤机制**: 避免错误分类(如快乐情绪被误判为痛点)
- **视频合成流水线**: FFmpeg驱动的高质量视频合成

## ✨ 技术特色

### 🎯 内容专业化
- **业务词表**: 专门针对行业的关键词库(A2奶源、HMO、自御力等)
- **品牌识别**: 智能识别启赋、illuma等知名品牌
- **场景理解**: 深度理解生活场景(喂养、护理、成长等)
- **情绪分析**: 准确识别内容中的正向情绪与痛点表达

### 🤖 AI模型协同
- **多模型融合**: Qwen视觉 + DeepSeek音频 + Google Cloud协同分析
- **智能兜底**: 视觉分析失败时自动启用音频分析补充
- **动态Prompt**: 基于`keywords.yml`动态生成AI指令，确保输出一致性
- **反幻觉升级**: 品牌感知的三层智能决策，避免误杀真实产品

### 🔧 工程化架构
- **模块化设计**: 四工厂独立运行，支持灵活组合
- **配置中心化**: `keywords.yml`统一管理所有业务配置
- **类型安全**: 完整的None值检查和异常处理
- **性能优化**: 智能缓存和批量处理机制

## 🚀 快速开始

### 环境要求
- Python 3.10+
- FFmpeg (视频处理)
- 8GB+ RAM (推荐)

### 安装步骤

1. **克隆项目**
```bash
git clone https://github.com/your-username/AI-video-master-4.0.git
cd AI-video-master-4.0
```

2. **创建虚拟环境**
```bash
python3.10 -m venv .venv
source .venv/bin/activate  # Linux/macOS
# 或者
.venv\Scripts\activate     # Windows
```

3. **安装依赖**
```bash
pip install -r requirements.txt
```

4. **配置API密钥**
```bash
cp .env.example .env
# 编辑 .env 文件，添加您的API密钥
```

### 启动工厂系统

**方式一：使用启动脚本**
```bash
# macOS/Linux
./启动工厂.command

# Windows
启动工厂.bat
```

**方式二：手动启动**
```bash
streamlit run streamlit_app/主页.py --server.port 8501
```

访问 `http://localhost:8501` 开始使用工厂系统。

## 📁 项目架构

### 🏗️ 模块化目录结构
```
AI-video-master-4.0/
├── 🏭 streamlit_app/              # 主应用目录
│   ├── 主页.py                    # 工厂系统首页
│   ├── pages/                     # 工厂页面
│   │   ├── 1_🧫_零件工厂.py       # 视频转录工厂
│   │   ├── 2_🧱_组装工厂.py       # 视频分析工厂
│   │   ├── 3_🧪_混剪工厂.py       # 视频混剪工厂
│   │   └── 4_🐛_调试工厂.py       # AI行为配置与调试
│   ├── config/                    # 应用级配置管理
│   │   └── config.py              # 主配置文件
│   ├── modules/                   # 功能模块
│   │   ├── factory/               # 各工厂UI组件与逻辑
│   │   ├── ai_analyzers/          # AI分析器 (Qwen, DeepSeek, Google, DashScope)
│   │   ├── analysis/              # 意图分析、片段处理
│   │   ├── data_process/          # 视频分割、元数据处理
│   │   ├── data_loader/           # 视频加载
│   │   ├── mapper.py              # 混剪映射引擎
│   │   └── composer.py            # 混剪合成引擎
│   └── utils/                     # 工具函数
│       ├── factory/               # 工厂通用工具
│       └── keyword_config.py      # 关键词与Prompt生成逻辑
├── 🔧 src/core/                   # 核心功能 (转录、分段)
│   ├── transcribe_core.py         # 转录核心
│   └── video_segmenter.py         # 视频分割器
├── ⚙️ config/                     # 项目级别配置
│   └── keywords.yml               # **核心配置文件** - AI业务词表与分类规则
├── 📦 models/                     # 本地AI模型
│   └── sentence_transformers/     # 语义相似度模型
├── 📊 data/                       # 数据目录
│   ├── input/                     # 输入视频
│   ├── output/                    # 输出结果
│   └── processed/                 # 处理后的片段
├── composed_video/                # 混剪视频输出目录
├── requirements.txt               # Python依赖
├── .env.example                   # 环境变量示例
├── 启动工厂.command               # macOS/Linux启动脚本
├── 启动工厂.bat                   # Windows启动脚本
└── README.md                      # 本文档
```

## 🏭 工厂使用指南

### 1. 🧫 零件工厂 - 视频转录
1. 进入零件工厂页面
2. 上传视频文件
3. 配置输出目录和转录参数
4. 启动转录，获得SRT字幕文件
5. 预览和下载结果

**支持格式**: MP4, AVI, MOV, WMV, MKV
**优化特性**: 专业词汇识别，提升转录准确率

### 2. 🧱 组装工厂 - 智能分析
1. 进入组装工厂页面
2. 选择分析模式 (视觉分析、音频分析、综合分析)
3. 配置AI模型参数
4. 执行批量分析
5. 查看分析结果和质量报告

**AI分析策略**:
- **一级分析**: Qwen视觉模型快速识别场景和物体
- **二级兜底**: DeepSeek音频分析补充空标签
- **三级融合**: 多模型结果智能合并
- **品牌识别**: 自动识别品牌元素

### 3. 🧪 混剪工厂 - 营销混剪
1. 进入混剪工厂页面
2. 选择标杆视频和素材池
3. 配置分类策略 (痛点/解决方案/卖点/促销)
4. 执行智能分类和片段筛选
5. 生成营销混剪视频

**分类算法**:
- **权重累积**: 基于关键词权重的智能评分
- **负向过滤**: 避免情绪词汇的错误分类
- **品牌保护**: 有品牌场景的智能保留机制
- **时长优化**: 智能控制各模块的时长分配

### 4. 🐛 调试工厂 - AI行为调优
1. 进入调试工厂页面
2. 在"批量定义"部分管理业务词表:
   - **物体词汇**: 奶粉、奶瓶、尿布等用品
   - **场景词汇**: 喂养、护理、玩耍等生活场景  
   - **情绪词汇**: 开心、担心、安心等情绪表达
   - **品牌词汇**: 启赋、illuma、A2奶源等品牌信息
3. 设置关键词权重 (1-4级)，影响AI识别优先级
4. 在"AI Prompt预览"查看配置效果
5. 点击"保存业务蓝图"将配置写入`keywords.yml`

**配置策略**:
- **高权重(3-4)**: 核心业务词汇，如品牌名、专业术语
- **中权重(2-3)**: 重要场景词汇，如生活场景
- **低权重(1-2)**: 通用情绪词汇，避免过度匹配

## ⚙️ 配置说明

### 环境变量 (.env)
```bash
# AI分析器配置
DASHSCOPE_API_KEY=your_dashscope_api_key                    # Qwen模型
DEEPSEEK_API_KEY=your_deepseek_api_key                      # DeepSeek模型  
GOOGLE_APPLICATION_CREDENTIALS=path/to/google-creds.json    # Google Cloud

# 工厂系统配置
DEBUG=false                                                 # 调试模式
USE_PROXY=false                                            # 代理设置
```

### 核心配置文件
- **config/keywords.yml**: **最重要的配置文件**，定义所有AI分析的业务词表、分类规则和权重配置
- **streamlit_app/config/config.py**: 应用级配置，控制系统行为参数

## 🛠️ 技术栈

### 前端框架
- **Streamlit 1.28+**: 现代化Web应用框架
- **多页面架构**: 模块化工厂设计

### AI模型集成
- **Qwen2.5-VL**: 阿里千问视觉模型，专注视频帧分析
- **DeepSeek-V3**: 音频转录与语义理解
- **Google Cloud Video Intelligence**: 视频内容深度分析
- **DashScope**: 阿里云语音转录服务

### 视频处理
- **FFmpeg**: 高性能视频转码和合成
- **OpenCV 4.7+**: 计算机视觉处理
- **MoviePy**: 视频编辑工具

### 数据处理
- **Pandas 2.0+**: 数据分析和处理
- **Sentence Transformers**: 语义相似度计算
- **PyTorch**: 深度学习框架支持

## 📊 系统性能

### 处理能力
- **单视频**: 支持最大2GB文件
- **批量处理**: 并发处理多个视频
- **分析速度**: 平均1分钟视频需要2-3分钟分析
- **内存优化**: 智能内存管理，支持长视频处理

### 分析精度
- **转录准确率**: >95% (中文内容)
- **场景识别**: >90% 准确率
- **品牌识别**: >85% 覆盖率 (知名品牌)
- **分类准确率**: >80% (四模块分类)

## 🚨 已知问题与解决方案

### 系统稳定性
- **API限流**: DashScope API可能遇到限流，系统会自动重试
- **内存管理**: 大视频文件建议分段处理
- **网络依赖**: 确保网络连接稳定，支持API调用

### 分类优化
- **权重平衡**: 通过调试工厂调整关键词权重，避免分类偏向
- **品牌保护**: 系统会智能保留包含知名品牌的片段
- **情绪识别**: 优化正向情绪词汇的权重配置

## 🔧 故障排除

### 常见问题

1. **API密钥配置**
```bash
# 检查环境变量
echo $DASHSCOPE_API_KEY
echo $DEEPSEEK_API_KEY
```

2. **依赖安装问题**
```bash
# 重新安装依赖
pip install -r requirements.txt --force-reinstall
```

3. **视频格式兼容性**
```bash
# 使用FFmpeg转换格式
ffmpeg -i input.mov -c:v libx264 -c:a aac output.mp4
```

4. **分类结果不理想**
- 进入调试工厂调整关键词权重
- 检查`keywords.yml`配置是否合理
- 查看AI Prompt预览确认配置效果

## 📝 更新日志

### v4.0 (当前版本) - 智能工厂
- ✅ **内容专业化**: 针对内容的专业词汇和场景优化
- ✅ **四模块分类**: 痛点/解决方案/卖点/促销的营销导向分类
- ✅ **品牌感知升级**: 智能识别品牌，避免误杀真实产品
- ✅ **反幻觉机制**: 三层智能决策，确保分析结果可靠性
- ✅ **权重算法优化**: 解决分类分布失衡问题
- ✅ **类型安全**: 完整的None值检查和异常处理
- ✅ **配置统一**: 以`keywords.yml`为核心的配置管理
- ✅ **多模型协同**: Qwen + DeepSeek + Google Cloud协同分析

### v3.0 - 智能分析增强
- ✅ Google Cloud Video Intelligence集成
- ✅ 多模型分析流水线
- ✅ 智能结果合并策略

### v2.0 - 功能完善
- ✅ 语义分析和意图匹配
- ✅ 批量处理支持
- ✅ 结果可视化

### v1.0 - 基础版本
- ✅ 视频转录和分析
- ✅ Streamlit界面

## 📄 许可证

本项目采用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情。

## 🤝 贡献指南

欢迎贡献代码和建议！请遵循以下步骤：

1. Fork 项目
2. 创建功能分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 开启 Pull Request


## 🔗 相关文档

- [📊 项目技术分析报告](项目技术分析报告.md) - 完整的技术架构和问题分析
- [📂 修复记录](修复记录/README.md) - 所有优化和重构文档汇总
- [🏗️ 重构总结](修复记录/REFACTORING_SUMMARY.md) - 详细的重构过程
- [📦 依赖说明](requirements.txt) - 完整的依赖包列表

---

**🏭 视频智能工厂 4.0** - 让内容营销更智能、更精准、更高效！ 